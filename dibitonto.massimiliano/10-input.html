<!DOCTYPE HTML>
<!--
	Prologue by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>How to make [almost] everything</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="Massimiliano Dibitonto, Fablab 2015 project and assignments portfolio" />
		<meta name="keywords" content="fablab, makers, fabacademy" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.scrolly.min.js"></script>
		<script src="js/jquery.scrollzer.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-wide.css" />
		</noscript>
		<!--[if lte IE 9]><link rel="stylesheet" href="css/ie/v9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>
	<body>

		<!-- Header -->
			<div id="header" class="skel-layers-fixed">

				<div class="top">

					<!-- Logo -->
						<div id="logo">
							<span class="image avatar48"><img src="images/profilo.jpg" alt="" /></span>
							<h1 id="title">Massimiliano</h1>
							<h1 id="title">Dibitonto</h1>
							<p>How to make [almost] everything</p>
						</div>

					<!-- Nav -->
						<nav id="nav">
							<!--
							
								Prologue's nav expects links in one of two formats:
								
								1. Hash link (scrolls to a different section within the page)
								
								   <li><a href="#foobar" id="foobar-link" class="icon fa-whatever-icon-you-want skel-layers-ignoreHref"><span class="label">Foobar</span></a></li>

								2. Standard link (sends the user to another page/site)

								   <li><a href="http://foobar.tld" id="foobar-link" class="icon fa-whatever-icon-you-want"><span class="label">Foobar</span></a></li>
							
							-->
							<ul>
								<li><a href="index.html" id="top-link" class="skel-layers-ignoreHref"><span class="icon fa-home">Home</span></a></li>
								</ul>
                                <ul>
								<li><a id="top-link" class="skel-layers-ignoreHref">Downloads for this week:</a></li>
                                <li><a href="https://github.com/maxdbt/fabmax/tree/master/boards/sensor_board"><span class="icon fa-git">Repo for board files</span></a></li>
                                <li><a href="files/sensor_board.brd"><span class="icon fa-cube">Eagle brd file</span></a></li>
                                <li><a href="files/sensor_board.sch"><span class="icon fa-cube">Eagle sch file</span></a></li>
          <li><a href="https://github.com/maxdbt/fabmax/tree/master/code/input"><span class="icon fa-git">Repo for code files</span></a></li>           <li><a href="files/Blink_fabkit.ino"><span class="icon fa-file-code-o">Blink code</span></a></li>     
         <li> <a href="files/analog_hello_serial_temp.ino"><span class="icon fa-file-code-o">Sensor read code</span></a></li>         
                              </ul>
						</nav>
						
				</div>
				
				<div class="bottom">

					<!-- Social Icons -->
						<ul class="icons">
							<li><a href="mailto:max.dbt@gmail.com" class="icon fa-envelope"><span class="label">Email</span></a></li>
						</ul>
				
				</div>
			
			</div>

		<!-- Main -->
			<div id="main">

				<!-- Intro -->
					<section id="top" class="one dark cover" >
						<div class="container">

							<header>
								<h2> <strong> 10 - Input devices </strong> </h2>
							
							</header>
							

						</div>
					</section>
							
					<section id="about" class="two">
						<div class="container">
						
							<header>
								<h3>Intro </h3>
							</header>
							<p> The assignment of this week was to create some boards to read from input devices. Indeed microcontrollers are able to operate upon information the need input devices to get data from the environment or from the user. </p>
					
                    <header>
					  <h3>The Fabkit Board</h3>
					  </header>
                      <p>I decided to make a board with a microcontroller, able to do generic purpose elaboration, and a shield (or daughterboard) to plug on it to connect input/output devices. I started from the <a href="http://fabacademy.org/archives/2015/doc/projects/fabkit-0.4.html">Fabkit board</a>, it has a ATMega 328P that is the same microcontroller used in the Arduino boards, with the advantage of having more pins and more memory that the Hello board that we already realized. You can find the design files and the BOM in the link provided. I milled the board on a FR-1 plate with the Roland SRM-20 with the procedure already described in the previous assignments.However as I want a faster board I used a 20MHz resonator instead of the 8 MHz one that is in the original design. Looking at the datasheet and at the ICSP pinout, I connected the MISO, MOSI, RESET, SCK, GND and VCC (app pin in the lower side of the board) of the board to the ICSP connector of the FabISP. As the FabISP doesn't provide power on the VCC pin I used the pin on the FTDI connector to power the board. I used an Arduino board without the microcontroller to have regulated +5V and to use the FTDI chip for the serial communication between the Fabkit board and the computer.
                      
                      I didn't follow the tutorial as it uses the 8MHz internal clock even if the board has a 20MHz resonator. To burn the bootloader and program the board I had to modify the boards.txt in the Arduino IDE. This file tell to the Arduino software the characteristics of the boards that you are going to program. So I changed the line 
                      <p>atmega168.build.f_cpu=16000000 to atmega168.build.f_cpu=20000000                    
                      <p>in the definition of the Arduino Pro 5v.                 So I could burn the bootloader successfully. To test the board I wrote a little sketch to make the on-board led blink. I looked at a mapping of microcontroller pins to Arduino pins (figure below) and I made the led mounted on pin PB5 - PIN13 blink.
                      <p><img src="http://1.bp.blogspot.com/-CoYms1FRXt8/Ue61oKNsqQI/AAAAAAAAAIM/377wUC_bAMs/s1600/atmega328_qtfp_web-600x424.png">
                        
                      <p>The sketch:</p>
                      <textarea style="width:80%; height:300px; font-size:16px">
int ledPin = 13;
// the setup function runs once when you press reset or power the board
void setup() {
  // initialize digital pin 13 as an output.
  pinMode(ledPin, OUTPUT);
}

// the loop function runs over and over again forever
void loop() {
  digitalWrite(ledPin, HIGH);   // turn the LED on (HIGH is the voltage level)
  delay(1000);              // wait for a second
  digitalWrite(ledPin, LOW);    // turn the LED off by making the voltage LOW
  delay(1000);              // wait for a second
}
                       </textarea>
                      <p>&nbsp;</p>
                    
                     <header>
					   <h3>Designing the input board</h3>
					  </header>
                      <p>I decided to design a shield that could snap on the Fabkit board (using headers) to do this I started from the pin on the Fabkit. As I wanted to connect a light sensor and a temperature sensor (both analog) I looked for pins with ADC (analog digital converter) The ADC can turn analog values to discrete values (from 0 to 1023). On the right side of the Fabkit we have this pins (Arduino names): VCC, GND, A5, A4, A3, A2,A1 and A0.
                      To connect the two sensor I need VCC, GND and two pins with ADC. So I decided to make a shiel that connects to adiacent pins (VCC,GND,A5 and A4). The LDR is a resistance that changes its values according to the quantity of light that goes on its surface. Even if it is not accurate as a phototransistor it is cheap and useful for a quick and dirty light measurement. To connect the LDR i added a 10k resistor to create a voltage divider. The LDR is connected to the VCC and the resistor to ground so I have a "natural" behaviour as the number will increase with the light.                      
                      <p>I decided  to read the temperature using th LM35 sensor.                      
                      <p><img src="http://www.learningaboutelectronics.com/images/LM35-temperature-sensor-pinout.png" alt=""></p>
                      <p>However using a float for the temperature value made the skech too big fot the ATTiny (4986Kb). So I used an int type and made other calculations in Processing. </p>
                      <p>To find the right temperature in Centigrades you have to use the formula temp = (5.0 * analogRead(tempPin) * 100.0) / 1024; or multiply the sensor value for 0.48828125. </p>
                      <p> It doesn't require any other components. So I designed the board with Eagle. However I did not find in the library the components I wanted to use. So I used other components with the same pinout: a phoresistor (2 pins) and a transistor (3 pins). 
                      <p><img src="images/input/sensorb.png" width="185" height="364">                      
                      <p>I had some problems because the holes exported by Eagle (even if the resolution was 2400 dpi) were too small (77px) to be recognized by the fabmodules. So I had to manually change the holes making it bigger (93px).	The	result	was	good:                                        
                    <p><img src="images/input/sensb_adone.jpg" width="96" height="173">                                        
                    <p><img src="images/input/sb_soldered.JPG" width="88" height="194">                                        
                    </p>
                     As at the moment I didn't have female headers to put on the board I used a breadboard only for connections. I uploaded this sketch:    <textarea style="width:80%; height: 300px; font-size:16px;"  >const int ldrPin = 4;  
const int tempPin = 1;
const int ledPin =  13;      // the number of the LED pin

void setup() {
  // initialize the LED pin as an output:
  pinMode(ledPin, OUTPUT);
  Serial.begin(9600);
}

void loop() {
int light = analogRead(ldrPin);
int temp = analogRead(tempPin);
float t  = temp * 0.48828125; // LM35 vuole una costante
//temp = temp * 0.137;
Serial.print(light);
Serial.print("/");  
Serial.println(temp);
delay(50);
}
                     </textarea>
<p>Then, I connected the shield to the Fabkit and added a conditional statement to make the led on the board lights up at a certain threshold. I added the following code:</p>                    
<p>
  <textarea style="width:80%; height: 100px; font-size:16px;"  > if(light > 400){<br>
digitalWrite(13,HIGH); <br>
}else{<br>
digitalWrite(13,LOW); <br>
}</textarea>
</p>
<p>The code also write the values on the serial port. I used an Arduino board without the microcontroller to have regulated +5V and to use the FTDI chip for the serial communication between the board and the computer. </p>
<p>The shield connected to the board:</p>
<p><img src="images/input/sb_connected.JPG" alt="" width="300" height="400"></p>
<p><img src="images/input/sb_connected2.jpg" alt="" width="300" height="400"></p>
<p>&nbsp;</p>
<p align="center">
<p>       <header>
<h3>
Downloads</h3>
</header>

<ul>
								
                                <li><a href="https://github.com/maxdbt/fabmax/tree/master/boards/sensor_board"><span class="icon fa-git">Repo for board files</span></a></li>
                                <li><a href="files/sensor_board.brd"><span class="icon fa-cube">Eagle brd file</span></a></li>
                                <li><a href="files/sensor_board.sch"><span class="icon fa-cube">Eagle sch file</span></a></li>
          <li><a href="https://github.com/maxdbt/fabmax/tree/master/code/input"><span class="icon fa-git">Repo for code files</span></a></li>           <li><a href="files/Blink_fabkit.ino"><span class="icon fa-file-code-o">Blink code</span></a></li>     
      <a href="files/analog_hello_serial_temp.ino"><span class="icon fa-file-code-o">Sensor read code</span></a></li>         
          
								
                      </ul>

             					
              </section>
				
		
			
				
			
			</div>

		<!-- Footer -->
			<div id="footer">
				
				<!-- Copyright -->
					<ul class="copyright">
						<li>&copy;  <img src="images/license.png" alt="" /> Attribution, non-commercial, share alike.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				
			</div>

	</body>
</html>