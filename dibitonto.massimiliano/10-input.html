<!DOCTYPE HTML>
<!--
	Prologue by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>How to make [almost] everything</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="Massimiliano Dibitonto, Fablab 2015 project and assignments portfolio" />
		<meta name="keywords" content="fablab, makers, fabacademy" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.scrolly.min.js"></script>
		<script src="js/jquery.scrollzer.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-wide.css" />
		</noscript>
		<!--[if lte IE 9]><link rel="stylesheet" href="css/ie/v9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>
	<body>

		<!-- Header -->
			<div id="header" class="skel-layers-fixed">

				<div class="top">

					<!-- Logo -->
						<div id="logo">
							<span class="image avatar48"><img src="images/profilo.jpg" alt="" /></span>
							<h1 id="title">Massimiliano</h1>
							<h1 id="title">Dibitonto</h1>
							<p>How to make [almost] everything</p>
						</div>

					<!-- Nav -->
						<nav id="nav">
							<!--
							
								Prologue's nav expects links in one of two formats:
								
								1. Hash link (scrolls to a different section within the page)
								
								   <li><a href="#foobar" id="foobar-link" class="icon fa-whatever-icon-you-want skel-layers-ignoreHref"><span class="label">Foobar</span></a></li>

								2. Standard link (sends the user to another page/site)

								   <li><a href="http://foobar.tld" id="foobar-link" class="icon fa-whatever-icon-you-want"><span class="label">Foobar</span></a></li>
							
							-->
							<ul>
								<li><a href="index.html" id="top-link" class="skel-layers-ignoreHref"><span class="icon fa-home">Home</span></a></li>
								</ul>
						</nav>
						
				</div>
				
				<div class="bottom">

					<!-- Social Icons -->
						<ul class="icons">
							<li><a href="mailto:max.dbt@gmail.com" class="icon fa-envelope"><span class="label">Email</span></a></li>
						</ul>
				
				</div>
			
			</div>

		<!-- Main -->
			<div id="main">

				<!-- Intro -->
					<section id="top" class="one dark cover" >
						<div class="container">

							<header>
								<h2> <strong> 10 - Input devices </strong> </h2>
							
							</header>
							

						</div>
					</section>
							
					<section id="about" class="two">
						<div class="container">
						
							<header>
								<h3>Intro </h3>
							</header>
							<p> The assignment of this week was to create some boards to read from input devices.</p>
						<header>
								<h3>Expanding the Hello Board</h3>
					  </header>
							<p>At first I decided to expand the Hello Board. Indeed, when not used for programming the pin of ICSP connector can be used for other purposes. For example the MISO pin has also an ADC converter, so it can be used to read from an analog sensor like a photoresistor. It corresponds to the Arduino analog pin 5 as you can see from the image below.</p>
							<p><img src="http://fc04.deviantart.net/fs70/f/2013/038/3/7/attiny_web_by_pighixxx-d5u4aur.png" width="700"> </p>
							<p><img src="images/input/IMG_4333.JPG" width="320" height="240"></p>
                      <p>So, as I live far from the Fablab, I decided at first to make a prototype on a breadboard. I used a photoresistor to read the light levels in the room. To read from it I had to make a voltage divider addign a 10k resistor. To read the values I printed them on the seria port. I programmed the board using the Arduino IDE and the SoftwareSerial library. I used an Arduino board without the microcontroller to have regulated +5V and to use the FTDI chip for the serial communication between the board and the computer.
                            Here is the code:</p>
                            <p align="left"><br>
                            #include &lt;SoftwareSerial.h&gt;</p>
                            <p align="left">SoftwareSerial mySerial(0, 1); // RX, TX<br>
                              // constants won't change. They're used here to<br>
                              // set pin numbers:<br>
                              const int ldrPin = 5;     // the number of the pushbutton pin<br>
                              const int ledPin =  8;      // the number of the LED pin                      </p>
                      <p align="left">void setup() {<br>
                              // initialize the LED pin as an output:<br>
                              pinMode(ledPin, OUTPUT);<br>
                              mySerial.begin(4800);<br>
  <br>
                              }</p>
                            <p align="left">void loop() {<br>
                              <br>
                              int val = analogRead(ldrPin);<br>
                              mySerial.println(val);<br>
                              delay(2);<br>
                              }</p>
                            <p>Moreover I decided to visualize it on a graph. So I used Processing that is very helpful to make fast data visualization.</p>
                            <p><img src="images/input/ldr_graph.png" width="300" height="238"></p>
                            <p>I started from <a href="http://arduino.cc/en/tutorial/graph">this example</a> then I customized it.As the message is a string I parsed it to an int. Then I mapped it to the dimension of the graph. You can find the code below:</p>
                            <p align="left"> import processing.serial.*;<br>
boolean connesso = false;<br>
Serial myPort;        // The serial port<br>
int xPos = 1;         // horizontal position of the graph<br>
<br>
void setup () {<br>
// set the window size:<br>
size(400, 300); <br>
stroke(255,255,0);<br>
for(int i=0;i&lt;300;i=i+50){<br>
line(0,i,400,i);<br>
}<br>
<br>
// elenca le porte seriali<br>
for(int i=0; i &lt;Serial.list().length;i++){<br>
println(&quot;[&quot;+ i +&quot;] &quot; + Serial.list()[i]); <br>
text(&quot;[&quot;+ i +&quot;] &quot; + Serial.list()[i], 15, 20*i +45); <br>
}<br>
// set inital background:<br>
background(0);<br>
}<br>
void draw () {</p>
                            <p align="left"> // everything happens in the serialEvent()<br>
                              }<br>
  <br>
                              void serialEvent (Serial myPort) {<br>
                              stroke(255,255,255);<br>
                              for(int i=0;i&lt;300;i=i+50){<br>
                              line(0,i,400,i);<br>
                              }<br>
                              // get the ASCII string:<br>
                              String inString = myPort.readStringUntil('\n');<br>
  <br>
                              if (inString != null) {<br>
                              // trim off any whitespace:<br>
                              inString = trim(inString);<br>
                              // convert to an int and map to the screen height:<br>
                              int ldr = int(inString); <br>
                              print(ldr);<br>
                              println(&quot; - &quot;);<br>
                              float ldrRel = map(ldr, 0, 1023, 0, height);<br>
                              println(ldrRel);<br>
  <br>
                              // draw the line:<br>
                              stroke(127,34,255);<br>
                              //line(xPos, height, xPos, height - inByte);<br>
                              point(xPos, height - ldrRel);<br>
  <br>
                              // at the edge of the screen, go back to the beginning:<br>
                              if (xPos &gt;= width) {<br>
                              xPos = 0;<br>
                              background(0); <br>
                              } <br>
                              else {<br>
                              // increment the horizontal position:<br>
                              xPos++;<br>
                              }<br>
                              }<br>
                              }<br>
  <br>
                              void keyPressed() {<br>
                              int k = key - 48;<br>
                              println(k);<br>
                              println(&quot;apro seriale &quot; + Serial.list()[k]);<br>
                              myPort = new Serial(this, Serial.list()[k], 4800);<br>
                              myPort.bufferUntil('\n');<br>
                              connesso= true;<br>
                              }</p>
                            <p>I decided also to read the temperature using th LM35 sensor.</p>
                            <p><img src="http://www.learningaboutelectronics.com/images/LM35-temperature-sensor-pinout.png"></p>
                            <p>However using a float for the temperature value made the skech too big fot the ATTiny (4986Kb). So I used an int type and made other calculations in Processing. </p>
                            <p>To find the right temperature in Centigrades you have to use the formula temp = (5.0 * analogRead(tempPin) * 100.0) / 1024; or multiply the sensor value for 0.48828125.                    </p>
					
                    <header>
								<h3>The Fabkit Board</h3>
					  </header>
                      <p>I decided to realize a board with multiple pins and more power and a shield (or daughterboard) to plug on it to connect input/output devices. I started from the <a href="http://fabacademy.org/archives/2015/doc/fabkit-0.4.html">Fabkit board</a> , it has a ATMega 328P that is the same microcontroller used in the Arduino boards, with the advantage of having more pins and more memory. I milled the board and I programmed it using the FabISP and the Arduino IDE. To do this, looking at the datasheet and at the ICSP pinout, I connected the MISO, MOSI, RESET, SCK, GND and VCC (app pin in the lower side of the board) to the ICSP connector of the FabISP. As the FabISP doesn't provide power on the VCC pin I used the pin on the FTDI connector to power the board. I used an Arduino board without the microcontroller to have regulated +5V and to use the FTDI chip for the serial communication between the Fabkit board and the computer.
                      
                      I didn't follow the tutorial as it uses the 8MHz internal clock even if the board has a 20MHz resonator. I looked at a mapping of microcontroller pins to Arduino pins (figure below) and I made the led mounted on pin PB5 - PIN13 blink (Arduino blink example).
                      <p><img src="http://1.bp.blogspot.com/-CoYms1FRXt8/Ue61oKNsqQI/AAAAAAAAAIM/377wUC_bAMs/s1600/atmega328_qtfp_web-600x424.png">
                        
                      <p>I had some problems with the serial communication that I wasn't able to solve. I receive strange characters. I tested different command as write and print with the same result.I checked also for short circuits but I had no result.</p>
                      <p><img src="images/input/IMG_4331.JPG" width="320" height="240"></p>
                      <p><img src="images/input/IMG_4332.JPG" width="320" height="240"></p>
                    
                     <header>
					   <h3>Designing the shield</h3>
					  </header>
                      <p>I decided to design a shield that could snap on the Fabkit board (using headers) to do this I started from the pin on the Fabkit. As I wanted to connect a light sensor and a temperature sensor (both analog) I looked for pins with ADC (analog digital converter) The ADC can turn analog values to discrete values (from 0 to 1023). On the right side of the Fabkit we have this pins (Arduino names): VCC, GND, A5, A4, A3, A2,A1 and A0.
                      To connect the two sensor I need VCC, GND and two pins with ADC. So I decided to make a shiel that connects to adiacent pins (VCC,GND,A5 and A4). To connect the LDR i added a 10k resistor to create a voltage divider. The LDR is connected to the VCC and the resistor to ground so I have a "natural" behaviour as the number will increase with the light.
                      For the temperature I used an LM35 (that I described above). It doesn't require any other components. So I designed the board with Eagle. However I did not find in the library the components I wanted to use. So I used other components with the same pinout: a phototransistor (2 pins) and a transistor (3 pins). 
                      <p><img src="images/input/sensorb.png" width="185" height="364">                                                                  
                    <p>You can download the <a href="http://www.massimilianodibitonto.it/fablab/sensor_board.brd">board</a> and the <a href="http://www.massimilianodibitonto.it/fablab/sensor_board.sch">schematic</a>.
                    <p>I had some problems because the holes exported by Eagle (even if the resolution was 2400 dpi) were too small (77px) to be recognized by the fabmodules. So I had to manually change the holes making it bigger (93px).	The	result	was	good:                                        
                    <p><img src="images/input/sensb_adone.jpg" width="96" height="173">                                        
                    <p><img src="images/input/sb_soldered.JPG" width="88" height="194">                                        
                    <p>As I got problems with the serial communication  of the Fabkit board I tested the shield with an Arduino Uno. I uploaded this sketch:
                    <p align="left">float temp;<br>
                      const int tempPin = A5;<br>
                      const int ldrPin = A4;<br>
                      int light;
                    <p align="left">void setup()<br>
                      {<br>
                      pinMode(13, OUTPUT);<br>
                      Serial.begin(9600);<br>
                      digitalWrite(13,HIGH); <br>
                      }</p>
                    <p align="left">void loop()<br>
                      {<br>
                      temp = analogRead(tempPin);<br>
                      temp = temp * 0.48828125; // LM35 vuole una costante<br>
                      //temp = temp * 0.137;<br>
                      light = analogRead(ldrPin);<br>
                      <br>
                      Serial.print(&quot;TEMPERATURE = &quot;);<br>
                      Serial.print(temp);<br>
                      Serial.print(&quot;*C&quot;);<br>
                      Serial.println();<br>
                      Serial.print(&quot;LIGHT = &quot;);<br>
                      Serial.print(light);<br>
                      Serial.println();<br>
  <br>
                      delay(1000);<br>
                      }</p>
                    <p>Then, as I cannot use the serial communication, I connected the shield to the Fabkit and added a conditional statement to make the led on the board lights up at a certain threshold. I added the following code:
                    <p align="left">if(light &gt; 400){<br>
digitalWrite(13,HIGH); <br>
}else{<br>
digitalWrite(13,LOW); <br>
}
                    <p align="center"><img src="images/input/sb_connected.JPG" width="318" height="281" align="middle">                                                            
                    <p>                    					
                    </section>
				
		
			
				
			
			</div>

		<!-- Footer -->
			<div id="footer">
				
				<!-- Copyright -->
					<ul class="copyright">
						<li>&copy;  <img src="images/license.png" alt="" /> Attribution, non-commercial, share alike.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				
			</div>

	</body>
</html>